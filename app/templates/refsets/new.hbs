<h1>Create New Refset</h1>

<div class="panel panel-info ember-view fade in panelNoPadding">
    <div class="panel-heading accordion-toggle" data-toggle="collapse" data-parent="#accordion" data-target="#refsetHeader">
         <h4 class="panel-title">Refset Header</h4>
    </div>
    <div class="panel-collapse collapse in">
        <div id="refsetHeader" class="panel-body">

			<label>Are you importing a Published Refset? {{view 'toggle-switch-inverted' checkedBinding="disablePublishedFormFields"}}</label>

			<form id="refsetEditForm" class="myForm">
				
				<table width="100%>
					
					<tr>
						<td class="content" colspan="4">
							<label class="control-label" for="description">Refset Description</label>
							{{textarea value=description}}
						</td>
					</tr>

					<tr>
						<td class="label">Language</td>
						<td class="content">
							{{snomed-data-dropdown valueBinding="languageCode" dataType="languagesArray"}}
			  			</td>
						<td class="label">Published Date</td><td class="content">				
						{{view Em.TextField 
							disabled=disablePublishedFormFields
							placeholder="Not Applicable"
						    valueBinding="meta.publishedDateInput"
							data-provide="datepicker"
							data-date-format="MM d, yyyy"
							data-date-clear-btn="true"
							data-date-autoclose="true"}}									
						</td>
					</tr>

					<tr>
						<td class="label">Refset Type</td>
						<td class="content">
							{{snomed-data-dropdown valueBinding="typeId" dataType="refsetTypesArray"}}
						</td>
						<td class="label">Refset Members Type</td>
						<td class="content">
							{{snomed-data-dropdown valueBinding="componentTypeId" dataType="componentTypesArray"}}
			  			</td>
					</tr>

					<tr>
						<td class="label">Creation Date</td>
						<td class="content">
							{{view Em.TextField 
								disabled=disablePublishedFormFields
								placeholder="Auto generated"
							    valueBinding="meta.createdDateInput"
								data-provide="datepicker"
								data-date-format="MM d, yyyy"
								data-date-clear-btn="true"
								data-date-autoclose="true"}}
						</td>
						<td class="label">Module</td><td class="content">
							{{snomed-data-dropdown valueBinding="moduleId" dataType="moduleTypesArray" id="newRefsetModuleId"}}
			  			</td>
					</tr>
					<tr>
						<td class="label">SCTID</td><td class="content" colspan=3>{{input type="text" value=id disabled=disablePublishedFormFields placeholder="Enter refset SCTID here"}}</td>
					</tr>
				
				</table>
			</form>
		</div>
	</div>
</div>

<!-- This requires vendore/my_utilities/drag_drop_file_upload.js --->
<div class="panel panel-info ember-view fade in">
    <div class="panel-heading accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" data-target="#refsetMembers">
         <h4 class="panel-title">Import Members</h4>
    </div>
    <div class="panel-collapse collapse in">
        <div id="refsetMembers" class="panel-body collapse">
		            	
			<h2>Import Members (flat file or single concept)</h2>
			<p>To import potential members from a flat-file of concept IDs, either use the browse button to locate your file, or drag a file below. You will then have an opportunity to review the members before initialting the actual import.</p>
			<p>You may also drag a single concept from the Snomed CT browser into the drop zone below to import that</p>
					
			<input type="file" id="refsetUploadFileInput" />
		
			<div id="fileUploadDropZone" class="fileUploadDropZone"><span id="droptext">Drop files here</span></div>
			
			<p><a href="/assets/temp/sample_refset.txt" target="_blank">Click here to download the latest sample refset file which you can use in the form above</a></p>
		
			{{#if potentialMembersToImport}}
				<button {{action 'clearImportList' id}} class="btn btn-default">Clear import list</button>
			{{/if}}
						
			{{#if getConceptDataInProgress}}		
				<h2>Importing member file</h2>
				<img src="assets/img/googleballs-animated.gif">
				<p><b>Please wait...</b></p>
			{{else}}
				{{#if importError}}
					<h2>Importing failed</h2>
					<p><b{{importError}}</b></p>
				{{/if}}
			{{/if}}
		</div>
	</div>
</div>
 
{{#unless getConceptDataInProgress}}
	{{#unless importError}}
		{{#if potentialMembersToImport}}
		    <div class="panel panel-info ember-view fade in panelNoPadding">
		        <div class="panel-heading accordion-toggle" data-toggle="collapse" data-parent="#accordion" data-target="#collapseTwo">
		             <h4 class="panel-title">Review potential members to import({{potentialMembersToImport.length}})</h4>
		        </div>
		        <div class="panel-collapse collapse in">
		            <div id="collapseTwo" class="panel-body">
						<ul class="list-group checkboxList">
								{{#each potentialMembersToImport}}
									<li {{bind-attr class=':list-group-item meta.conceptActive::inactiveConcept meta.deleteConcept:deleteConcept'}}>

										<label class="right">SCTID <span>{{referencedComponentId}}</span></label>
										<p class="description">{{meta.description}}</p>									

										{{#if meta.found}}
											<label>Import as active{{view 'toggle-switch' checkedBinding="active" value="id"}}</label>

											<label>Module:
												<span>
													{{#if published}}
														{{snomed-id-to-label moduleId outerView.controller.moduleTypes}}
													{{else}}
														{{snomed-data-dropdown valueBinding="moduleId" dataType="moduleTypesArray"}}
													 {{/if}}
									 			</span>
											</label>
												
											{{#unless meta.conceptActive}}<label class="warning">Note: This concept is INACTIVE</label>{{/unless}}
										{{/if}}

										{{#unless published}}<label class="right clearRight">Import this concept {{view 'toggle-switch-inverted' checkedBinding="meta.deleteConcept" value="id"}}</label>{{/unless}}
									</li>
								{{/each}}
						</ul>
					</div>
				</div>
			</div>
		{{/if}}
	{{/unless}}
{{/unless}}

<button {{action "clearForm"}} class="btn btn-default">Clear Form</button>
<button {{action "initRefsetImport"}} class="btn btn-primary right">Create Refset</button>
