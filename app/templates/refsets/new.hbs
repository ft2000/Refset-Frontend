<h1>Create New Refset</h1>

<div class="row">
	
	<div class="col-md-9">
			
		<div class="panel panel-info ember-view fade in">
		    <div class="panel-heading accordion-toggle" data-toggle="collapse" data-parent="#accordion" data-target="#refsetHeader">
		         <h4 class="panel-title">Refset Header</h4>
		    </div>
		    <div class="panel-collapse collapse in">
		        <div id="refsetHeader" class="panel-body">

					{{#unless isRF2Import}}
						<label>Are you importing a Published Refset?</label> {{radio-button value=false checked=disablePublishedFormFields}} Yes {{radio-button value=true checked=disablePublishedFormFields}} No
					{{/unless}}
					
					<form class="refset-header">
						
						<table width="100%">
						
							<tr>
								{{#if isRF2Import}}	
									<td class="label">Refset Description</td>
									<td class="content" colspan="3">
										{{rf2FileToImport.label}}
						  			</td>
								{{else}}
									<td class="content" colspan="4">
										<label class="control-label" for="description" class="form-control">Refset Description</label>
										{{textarea value=description class="form-control"}}
									</td>
								{{/if}}
							</tr>
									
							<tr>
								<td class="label">Language</td>
								<td class="content">
									{{snomed-data-dropdown valueBinding="languageCode" dataType="languagesArray" class="form-control"}}
					  			</td>
							</tr>
		
							<tr>
								<td class="label">Refset Type</td>
								<td class="content">
									{{snomed-data-dropdown valueBinding="typeId" dataType="refsetTypesArray" class="form-control"}}
								</td>
								<td class="label">Refset Members Type</td>
								<td class="content">
									{{snomed-data-dropdown valueBinding="componentTypeId" dataType="componentTypesArray"}}
					  			</td>
							</tr>

							<tr>
								<td class="label">Anticipated Published Date</td><td class="content">
									{{view Em.TextField 
										placeholder="Date expected to be published"
									    valueBinding="meta.publishedDateInput"
										data-provide="datepicker"
										data-date-format="MM d, yyyy"
										data-date-clear-btn="true"
										data-date-autoclose="true"
										class="form-control"}}								
								</td>
								<td class="label">Module</td><td class="content">
									{{snomed-data-dropdown valueBinding="moduleId" dataType="moduleTypesArray" id="newRefsetModuleId" class="form-control"}}
					  			</td>
							</tr>
							<tr>
								<td class="label">SCTID</td>
								{{#if isRF2Import}}									
									<td class="content" colspan=3>
										{{rf2FileToImport.id}}
									</td>
								{{else}}
									<td class="content" colspan=3>
										{{#if disablePublishedFormFields}}
											{{input type="text" value=id disabled="true" placeholder="A temporary UUID will be auto generated" class="form-control"}}
										{{else}}
											{{input type="text" value=id placeholder="Enter refsetId (SCTID) here" class="form-control"}}
										{{/if}}
									</td>
								{{/if}}
							</tr>

						</table>
					</form>
				</div>
			</div>
		</div>

		{{#if isRF2Import}}
			
		    <div class="panel panel-info ember-view fade in">
		        <div class="panel-heading accordion-toggle" data-toggle="collapse" data-parent="#accordion" data-target="#importRF2File">
		             <h4 class="panel-title">Import RF2 File</h4>
		        </div>
		        <div class="panel-collapse collapse in">
		            <div id="importRF2File" class="panel-body member-list">
		            	
						{{#if potentialMembersToImport}}
						
			            	{{#if moreThanOneRefsetInRF2}}
							
								Your RF2 file contains more than one Refset. Please choose which refset you wish to import:
							
								<p>
								{{#each member in potentialMembersToImport}}					
									<label class="notALabel">{{radio-button value=member.id name='refsetId' checked=rf2FileToImport.id}} {{member.id}} | {{member.label}} | {{member.concepts.length}} members</label><br>
								{{/each}}
								</p>
							
							{{else}}
							
								Your RF2 file contains a single Refset:
							
								<p>
								{{#each member in potentialMembersToImport}}					
									{{member.id}} | {{member.label}} | {{member.concepts.length}} members<br>
								{{/each}}
								</p>
							
							{{/if}}
						{{else}}
							There are no published refsets in that file...
						{{/if}}
					</div>
				</div>
			</div>	

		{{else}}
		
			{{#unless importError}}
				{{#if potentialMembersToImport}}
				    <div class="panel panel-info ember-view fade in panelNoPadding">
				        <div class="panel-heading accordion-toggle" data-toggle="collapse" data-parent="#accordion" data-target="#importMemberList">
				             <h4 class="panel-title">Review potential members to import({{potentialMembersToImport.length}})</h4>
				        </div>
				        <div class="panel-collapse collapse in">
				            <div id="importMemberList" class="panel-body member-list">
				            	{{#with controller.moduleTypesArray as moduleTypesArray }}
									 {{#collection Ember.ListView contentBinding="potentialMembersToImport" height=400 rowHeight=59 width="100%"}}
										<div {{bind-attr class=':list-group-item :member-list-item meta.conceptActive::inactiveConcept meta.deleteConcept:deleteConcept'}}>
											<span class="trashIcon"><a {{action 'toggleImportMember' referencedComponentId}} {{bind-attr class=':pointer :icon meta.deleteConcept:undelete:delete'}}"></a></span>
		
											<div class="listViewRow"><span class="sctid">{{referencedComponentId}}</span> | <span class="description">{{description}}</span> |</div>						
		
											<span class="tickIcon"><a {{action 'toggleImportMemberActive' referencedComponentId}} {{bind-attr class=':pointer :icon active:tick:cross'}}"></a></span>
		
											<label><span>{{view Em.Select value=content.moduleId content=moduleTypesArray optionValuePath="content.id" optionLabelPath="content.label" class="form-control"}}</span></label>
					
											{{#unless meta.conceptActive}}<label class="inactiveMemberText">Note: This concept is INACTIVE</label>{{/unless}}
										</div>
									  {{/collection}}
								  {{/with}}
							</div>
						</div>
					</div>
				{{/if}}
			{{/unless}}
			
		{{/if}}
	</div>
							
						
	<div class="col-md-3">	

		<!-- This requires vendor/my_utilities/drag_drop_file_upload.js --->
		<h2>Import Members <a {{action 'showImportHelp' }}class="right icon info pointer"></a></h2>
		<div id="fileUploadDropZone" class="fileUploadDropZone"><span id="droptext">Drag an RF2 file, a file of concept IDs or an individual concept from the Snomed CT browser here.<br><br>Alternatively use the file requestor below to choose a file.</span></div>
		<br><input type="file" id="refsetUploadFileInput" />
		
		{{#if potentialMembersToImport}}
			<button {{action 'clearImportList' id}} class="btn btn-default btn-side-menu">Clear import list</button>
		{{/if}}
		
		{{#if getConceptDataInProgress}}		
			<h2>Importing member file</h2>
			{{bs-progress progressBinding="importProgress" type="info" stripped="true"}}
			<p><b>Please wait...</b></p>
		{{else}}
			{{#if importError}}
				<h2>Importing failed</h2>
				<p><b{{importError}}</b></p>
			{{/if}}

			<button {{action "clearForm"}} class="btn btn-danger left">Clear Form</button>
			<button {{action "initRefsetImport"}} class="btn btn-primary right">Create Refset</button>

		{{/if}}
	</div>
</div>
